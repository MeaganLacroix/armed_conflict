---
title: "Exploratory Data Analysis"
author: "Meagan Lacroix"
format: pdf
editor: visual
---

##This is a work in progress and is not quite finished yet!
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#| message = FALSE
library(here)
library(dplyr)
library(arrow)
library(janitor)
library(knitr)
library(lubridate)
library(mice)
library(modelsummary)
library(naniar)
library(tidyverse)
```

# Read in the merged data
```{r}
#| warning: false
eda_data <- read.csv(here("data", "finaldata.csv"), header = TRUE)
```

# Check names, head/tail
```{r}
names(eda_data)
head(eda_data)
tail(eda_data)
```
# Formatting of variable names is inconsistent. Run this code for more consistency
```{r}
eda_data <- eda_data %>%
  clean_names()
```

```{r}
eda_data <- eda_data %>%
  mutate(across(c(oecd, oecd2023, armconf1, drought, earthquake), as.factor))
```

# Summarize the variables. There is a large amount of missing data for maternal mortality. This will be investigated further

```{r}
eda_data %>% summary()
```
# Checking the names of the character variables. These were imported from ISO so are assumed to be accurate
```{r}
unique(eda_data$country_name)
unique(eda_data$iso)
unique(eda_data$region)
```
# Creating histograms of the numeric variables. Total deaths is difficult to visualize because there is a large number of 0-1 deaths and a very small frequency of larger # deaths. This will be investigated further.
```{r}
numeric_vars <- eda_data %>%
  select(where(is.numeric)) %>%  
  names() 

for (var in numeric_vars) {
  p <- ggplot(eda_data, aes(x = !!sym(var))) +  # Dynamically assign variable
    geom_histogram(binwidth = 1, fill = "blue") + 
    xlab(var) +  # Set x-axis label to the variable name
    theme_minimal()
  
  print(p)  
}
```
# 2730 (73%) rows of data had 0 battle-related deaths in the study time-frame. 
```{r}

totdeath_counts <- eda_data %>%
  group_by(totdeath) %>%  
  summarize(count = n())  

print(totdeath_counts)

```
# Summary of deaths by Country. Syria had the largest number of battle-related deaths. Sierra Leone had the  most maternal, infant, and under 5 deaths. Pakistan had the most neonatal deaths.Andora, Dominica, and Marshall Islands had no maternal death data. Puerto Rico had no infant, neonatal, or under5 data. We may wish to exclude Puerto Rico from subsequent analyses.   
```{r}
# Total deaths table with NA count by country
eda_data %>%
  group_by(country_name) %>%
  summarise(
    total_deaths = sum(totdeath, na.rm = TRUE),
    total_deaths_NA = sum(is.na(totdeath))
  ) %>%
  arrange(desc(total_deaths))

# Maternal deaths table with NA count by country
eda_data %>%
  group_by(country_name) %>%
  summarise(
    maternal_deaths = sum(mor_mat, na.rm = TRUE),
    maternal_deaths_NA = sum(is.na(mor_mat))
  ) %>%
  arrange(desc(maternal_deaths))

# Infant deaths table with NA count by country
eda_data %>%
  group_by(country_name) %>%
  summarise(
    infant_deaths = sum(mor_inf, na.rm = TRUE),
    infant_deaths_NA = sum(is.na(mor_inf))
  ) %>%
  arrange(desc(infant_deaths))

# Neonatal deaths table with NA count by country
eda_data %>%
  group_by(country_name) %>%
  summarise(
    neonatal_deaths = sum(mor_neonat, na.rm = TRUE),
    neonatal_deaths_NA = sum(is.na(mor_neonat))
  ) %>%
  arrange(desc(neonatal_deaths))

# Under-5 deaths table with NA count by country
eda_data %>%
  group_by(country_name) %>%
  summarise(
    under5_deaths = sum(mor_under5, na.rm = TRUE),
    under5_deaths_NA = sum(is.na(mor_under5))
  ) %>%
  arrange(desc(under5_deaths))
```

# Summary of deaths by year. The most battle-related deaths occured in 2015. The most maternal, infant, neonatal, and under 5 deaths occured in 2000. There were many NAs for maternal deaths in 2018/2019. 
```{r}
# Total deaths by year with NA count
eda_data %>%
  group_by(year) %>%
  summarise(
    total_deaths = sum(totdeath, na.rm = TRUE),
    total_deaths_NA = sum(is.na(totdeath))
  ) %>%
  arrange(desc(total_deaths))

# Maternal deaths by year with NA count
eda_data %>%
  group_by(year) %>%
  summarise(
    maternal_deaths = sum(mor_mat, na.rm = TRUE),
    maternal_deaths_NA = sum(is.na(mor_mat))
  ) %>%
  arrange(desc(maternal_deaths))

# Infant deaths by year with NA count
eda_data %>%
  group_by(year) %>%
  summarise(
    infant_deaths = sum(mor_inf, na.rm = TRUE),
    infant_deaths_NA = sum(is.na(mor_inf))
  ) %>%
  arrange(desc(infant_deaths))

# Neonatal deaths by year with NA count
eda_data %>%
  group_by(year) %>%
  summarise(
    neonatal_deaths = sum(mor_neonat, na.rm = TRUE),
    neonatal_deaths_NA = sum(is.na(mor_neonat))
  ) %>%
  arrange(desc(neonatal_deaths))

# Under-5 deaths by year with NA count
eda_data %>%
  group_by(year) %>%
  summarise(
    under5_deaths = sum(mor_under5, na.rm = TRUE),
    under5_deaths_NA = sum(is.na(mor_under5))
  ) %>%
  arrange(desc(under5_deaths))

```
```{r}
vis_miss(eda_data)
```
```{r}
gg_miss_var(eda_data, facet = year)

```

```{r}
new_data <- data.frame(eda_data$country_name, eda_data$year, eda_data$mor_mat)

gg_miss_fct(new_data, fct = country_name) +
  labs(title = "Susceptibility Missingness for OLIS and Hospital, Grouped by Organism")+
  theme(plot.title = element_text(hjust = 0.5))
ggsave("plot_missing_spercent_organism_19AUG24.pdf", plot = missing_naniar, width = 20, height = 8, dpi = 300)
```


